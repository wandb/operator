---
# MySQL - Percona XtraDB Cluster
# Scrapes mysqld-exporter sidecar from PXC nodes
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMPodScrape
metadata:
  name: mysql-pxc
  namespace: default
spec:
  selector:
    matchLabels:
      app.kubernetes.io/component: pxc
  podMetricsEndpoints:
    - port: "metrics"
      path: /metrics
---
# MySQL - ProxySQL
# Scrapes ProxySQL built-in Prometheus metrics
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMPodScrape
metadata:
  name: mysql-proxysql
  namespace: default
spec:
  selector:
    matchLabels:
      app.kubernetes.io/component: proxysql
  podMetricsEndpoints:
    - port: "stats"
      path: /metrics
---
# Kafka - Strimzi
# Scrapes Kafka broker metrics via Strimzi Metrics Reporter
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMPodScrape
metadata:
  name: kafka-brokers
  namespace: default
spec:
  selector:
    matchLabels:
      strimzi.io/kind: Kafka
  podMetricsEndpoints:
    - port: "tcp-prometheus"
      path: /metrics
---
# MinIO Tenant
# Scrapes MinIO metrics endpoint (auth disabled when telemetry enabled)
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMPodScrape
metadata:
  name: minio-tenant
  namespace: default
spec:
  selector:
    matchLabels:
      v1.min.io/tenant: wandb-minio
  podMetricsEndpoints:
    - port: "minio-port"
      path: /minio/metrics/v3
      scheme: https
      tlsConfig:
        insecureSkipVerify: true
---
# Redis
# Scrapes Redis exporter sidecar metrics
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMPodScrape
metadata:
  name: redis
  namespace: default
spec:
  selector:
    matchLabels:
      role: replication
  podMetricsEndpoints:
    - port: "redis-exporter"
      path: /metrics
---
# ClickHouse
# TODO: Implement clickhouse-exporter sidecar
# The Altinity ClickHouse operator doesn't support adding sidecar containers
# through the pod template. Requires alternative approach (mutating webhook, etc.)
# apiVersion: operator.victoriametrics.com/v1beta1
# kind: VMPodScrape
# metadata:
#   name: clickhouse
#   namespace: default
# spec:
#   selector:
#     matchLabels:
#       clickhouse.altinity.com/chi: wandb-ch-install
#   podMetricsEndpoints:
#     - port: "9363"
#       path: /metrics
